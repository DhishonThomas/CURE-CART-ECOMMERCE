<%- include('../partials/header'); -%>




<section class="content-main">

<style>
  .image-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start; /* Align items at the start of the container */
  }

  .image-box {
    flex: 0 0 calc(33.33% - 8px); /* Adjust the width as needed, considering margin */
    margin: 4px; /* Add margin between image boxes */
    overflow: hidden;
  }

  .image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>
 <div class="col-md-15 mr-auto ">
  <form
    id="myForm"
    action="/admin/createProduct"
    method="post"
    enctype="multipart/form-data"
  >
    <div class="row">
      <div class="col-6">
        <div class="content-header">
          <h2 class="content-title">Add New Product</h2>
          <div></div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <div class="card mb-4">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">
                <h6>1. General info</h6>
              </div>
              <div class="col-md-9">
                <div class="mb-4">
                  <label class="form-label">Product title</label>
                  <input
                    type="text"
                    placeholder="Type here"
                    class="form-control"
                    id="productName"
                    name="productName"
                  />
                </div>
                <div class="mb-4">
                  <label class="form-label">Description</label>
                  <textarea
                    placeholder="Type here"
                    class="form-control"
                    rows="4"
                    id="description"
                    name="description"
                  ></textarea>
                </div>
                <div class="mb-4">
                  <label class="form-label">Brand name</label>
                <input
                    type="text"
                    placeholder="Type here"
                    class="form-control"
                    id="brand"
                    name="brand"
                  />
                </div>
              </div>
              <!-- col.// -->
            </div>
            <!-- row.// -->
            <hr class="mb-4 mt-0" />
            <div class="row">
              <div class="col-md-3">
                <h6>2. Pricing</h6>
              </div>
              <div class="col-md-9">
                <div class="mb-4">
                  <label class="form-label">Cost in USD</label>
                  <input
                    type="text"
                    placeholder="$00.0"
                    class="form-control"
                    id="price"
                    name="price"
                  />
                </div>
              </div>
              <!-- col.// -->
            </div>
            <!-- row.// -->
            <hr class="mb-4 mt-0" />
            <div class="row">
              <div class="col-md-3">
                <h6>3. Category</h6>
              </div>

              <div class="col-md-9">
                <div class="mb-4">
                  <% category.forEach(category => { %>
                  <label
                    class="mb-2 form-check form-check-inline"
                    style="width: 45%"
                  >
                    <input
                      class="form-check-input"
                      name="mycategory"
                      type="radio"
                      id="category"
                      value="<%=category.category_name%>"
                     
                    />
                    <span class="form-check-label">
                      <%= category.category_name %>
                    </span>
                  </label>
                  <% }); %>
                </div>
              </div>
              <!-- col.// -->
            </div>
            <!-- row.// -->
            <hr class="mb-4 mt-0" />
            <div class="row">
              <div class="col-md-3">
                <h6>4. Quantity</h6>
              </div>
              <div class="col-md-9">
                <div class="mb-4">
                  <label class="form-label">Available Quantity</label>
                  <input
                    type="number"
                    min="1"
                    placeholder="Enter quantity"
                    class="form-control"
                    id="quantity"
                    name="quantity"
                  />
                </div>
              </div>
              <!-- col.// -->
            </div>
            <!-- .row end// -->

            <!-- Added Quantity field -->
            <hr class="mb-4 mt-0" />
            <div class="row">
              <div class="col-md-3">
                               <h6>5. Media</h6>
                            </div>
                            <div class="col-md-9">
                                <div class="mb-4">
                                    <label class="form-label">Images</label>
                                    <input
                                        id="images"
                                        name="images"
                                        multiple
                                        class="form-control"
                                        type="file"
                                        onchange="handleImage()"
                                    />
                                </div>

                                <!-- <div class="d-flex align-items-start">
                                    <div class="mb-4 me-4"> -->
                                        <!-- Display the original image -->
                                        <!-- <img id="output" class="img-fluid" alt="Original Image" />
                                    </div>

                                    <div class="mb-4">
                                        <button
                                            id="cropImgBtn"
                                            class="btn btn-md rounded font-sm hover-up"
                                            disabled
                                        >
                                            Crop image
                                        </button>
                                    </div>
                                </div>

                                <div id="croppedOutputContainer" class="mb-4 text-end">
                                    Display the cropped image on the right side
                                    <img id="croppedOutput" class="img-fluid" alt="Cropped Image" />
                                </div> -->

                                <!-- Moved the submit button to the end -->
                                <div class="row">
                                    <div class="col-md-12 text-end">
                                        <button class="btn btn-md rounded font-sm hover-up" onclick="submitForm()">
                                            Submit
                                        </button>
                                          <!-- <input type="hidden" id="croppedImageData" name="croppedImageData" /> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </form>
 <div class="col-md-6 bg-light">
  <h6 class="text-center">Image Preview</h6>
  <div id="imagePreviewContainer" class="image-container">
    <!-- Image previews will be displayed here -->
  </div>
</div>


</section>


<script>
  function handleImage() {
    var input = document.getElementById('images');
    var realTimePreviewContainer = document.getElementById('imagePreviewContainer');
    realTimePreviewContainer.innerHTML = ''; // Clear existing previews

    for (var i = 0; i < input.files.length; i++) {
      var reader = new FileReader();
      reader.onload = function (e) {
        var div = document.createElement('div');
        div.className = 'image-box';
        var img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'img-fluid';
        div.appendChild(img);
        realTimePreviewContainer.appendChild(div);
      };
      reader.readAsDataURL(input.files[i]);
    }
  }

</script>

<!-- <script>
  let cropper; // Define cropper as a global variable

  function handleImage() {
    const input = document.getElementById("image");
    const file = input.files[0];
    console.log("Selected file:", file);

    if (file) {
      const reader = new FileReader();

      reader.onload = function (e) {
        const imageUrl = e.target.result;

        // Initialize CropperJS on the image element
        cropper = new Cropper(document.getElementById("output"), {
          aspectRatio: 0,
          viewMode: 1,
        });

        // Set the source of the Cropper to the selected image
        cropper.replace(imageUrl);

        // Enable the Crop button
        document.getElementById("cropImgBtn").disabled = false;
      };

      reader.readAsDataURL(file);
    }
  }



document.getElementById("cropImgBtn").addEventListener("click", (event) => {
    event.preventDefault();
    
    const croppedCanvas = cropper.getCroppedCanvas();
    if (croppedCanvas) {
      // Convert the cropped image data to a Blob
      croppedCanvas.toBlob((blob) => {
        const formData = new FormData();
        formData.append("croppedImage", blob, "cropped-image.jpg");

        // Display the cropped image
        var croppedImage = croppedCanvas.toDataURL("image/jpeg");
        document.getElementById("croppedOutput").src = croppedImage;

        // Store the Blob in a hidden input field
        document.getElementById("croppedImageData").value = blob;

        console.log("Cropped image data stored.");
      }, "image/jpeg");
    } else {
      // Handle case where no selection is made
      console.error("No selection made.");
    }
  });
  function submitForm() {

        var croppedImage = document.getElementById("croppedImageData").value;

    var productName = document.getElementById("productNmae").value;
    var description = document.getElementById("description").value
    var brand       = document.getElementById("brand").value
    var price       = document.getElementById("price").value   
    var category    = document.getElementById("category").value
    var quantity    = document.getElementById("quantity").value

    var formData = {
  productName: productName,
  description: description,
  brand: brand,
  price: price,
  category: category,
  quantity: quantity,
  croppedImageData:croppedImage,
};
    
// const croppedCanvas = cropper.getCroppedCanvas();
// console.log("image when submit button clicked",croppedCanvas);
    fetch('/admin/createProduct', {
      method: 'POST',
      body: JSON.stringify(formData),

    })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
      })
      .catch(error => {
        console.error('Error:', error);
        // Handle errors
      });
  }
</script> -->

<%- include('../partials/footer'); -%>
