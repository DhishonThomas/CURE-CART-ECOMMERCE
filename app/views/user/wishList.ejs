<%- include('../partialsUser/header'); -%>

     
     
     <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Wishlist<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="container">
					<table class="table table-wishlist table-mobile">
						<thead>
							<tr>
								<th>Product</th>
								<th>Price</th>
								<th>Stock Status</th>
								<th></th>
								<th></th>
							</tr>
						</thead>

						<tbody>
    <% wishList.products.forEach(product => { %>
    <tr>
        <td class="product-col">
            <a href="/product/<%= product.productId._id %>">
                <div class="product">
                    <figure class="product-media">
                        <img src="<%= product.productId.images[0] %>" alt="Product image">
                    </figure>
                    <h3 class="product-title">
                        <%= product.productId.productName  %>
                    </h3><!-- End .product-title -->
                </div><!-- End .product -->
            </a>
        </td>
        <td class="price-col"><%= product.productId.price  %></td>
        <td class="stock-col"><span class="in-stock">In stock</span></td>
           <td> <button class="btn-remove" data-product-id="<%= product.productId._id %>"><i class="icon-close"></i></button></td>
    </tr>
    <% }) %>
</tbody>

					</table><!-- End .table table-wishlist -->
	            	<div class="wishlist-share">
	            		<div class="social-icons social-icons-sm mb-2">
	            			<label class="social-label">Share on:</label>
	    					<a href="#" class="social-icon" title="Facebook" target="_blank"><i class="icon-facebook-f"></i></a>
	    					<a href="#" class="social-icon" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>
	    					<a href="#" class="social-icon" title="Instagram" target="_blank"><i class="icon-instagram"></i></a>
	    					<a href="#" class="social-icon" title="Youtube" target="_blank"><i class="icon-youtube"></i></a>
	    					<a href="#" class="social-icon" title="Pinterest" target="_blank"><i class="icon-pinterest"></i></a>
	    				</div><!-- End .soial-icons -->
	            	</div><!-- End .wishlist-share -->
            	</div><!-- End .container -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

        <%- include('../partialsUser/footer'); -%>

        <script>

const removeItemFromWishlist = async (productId) => {
    Swal.fire({
        title: 'Are you sure?',
        text: 'You are about to remove this item from your wishlist.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, remove it!',
        cancelButtonText: 'Cancel'
    }).then(async (result) => {
        if (result.isConfirmed) {
            try {
                const response = await fetch(`/wishlistRemove/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Item Removed',
                        text: 'The item has been removed from your wishlist.',
                    }).then((result) => {
                        // Optionally, you can update the UI here to reflect the removed item
                        if (result.isConfirmed) {
    location.reload();
                        }
                    });
                } else {
                    console.error('Failed to remove item from wishlist');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    });
};

document.addEventListener('DOMContentLoaded', () => {
    const removeButtons = document.querySelectorAll('.btn-remove');
console.log(removeButtons);
    removeButtons.forEach((button) => {
        button.addEventListener('click', async (event) => {
            event.preventDefault();
            const productId = button.dataset.productId
            console.log(productId);
            await removeItemFromWishlist(productId);
        });
    });
});



        </script>
